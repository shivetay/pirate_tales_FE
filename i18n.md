# React-i18next Configuration Guide for Next.js

This guide provides step-by-step instructions to configure react-i18next with next-i18n-router for your Next.js project.

## Prerequisites

Your project already has the necessary dependencies installed:

- `react-i18next`: ^16.2.0
- `i18next`: ^25.6.0
- `next-i18n-router`: ^5.5.4

## Step 1: Create i18n Configuration File

Create `src/i18n.ts` file with the following configuration:

```typescript
import i18n from "i18next";
import { initReactI18next } from "react-i18next";
import en from "./locales/en/common.json";
import pl from "./locales/pl/common.json";

const resources = {
  en: {
    translation: en,
  },
  pl: {
    translation: pl,
  },
};

i18n.use(initReactI18next).init({
  resources,
  lng: "en", // default language
  fallbackLng: "en",
  interpolation: {
    escapeValue: false, // React already does escaping
  },
});

export default i18n;
```

## Step 2: Update Next.js Configuration

Modify your `next.config.ts` to include i18n configuration:

```typescript
import type { NextConfig } from "next";
import createNextIntlPlugin from "next-i18n-router/plugin";

const withNextIntl = createNextIntlPlugin("./i18nConfig.js");

const nextConfig: NextConfig = {
  /* config options here */
};

export default withNextIntl(nextConfig);
```

## Step 3: Create Middleware

Create `src/middleware.ts` to handle locale routing:

```typescript
import createMiddleware from "next-i18n-router/middleware";
import { i18nConfig } from "./i18nConfig";

export default createMiddleware(i18nConfig);

export const config = {
  matcher: ["/((?!api|_next/static|_next/image|favicon.ico).*)"],
};
```

## Step 4: Update i18nConfig.js

Your existing `i18nConfig.js` is correct, but ensure it exports the configuration properly:

```javascript
const i18nConfig = {
  locales: ["en", "pl"],
  defaultLocale: "en",
};

module.exports = i18nConfig;
```

## Step 5: Create i18n Provider

Create `src/providers/i18n-provider.tsx`:

```typescript
"use client";
import { useEffect } from "react";
import { useRouter } from "next/navigation";
import { useTranslation } from "react-i18next";
import "@/i18n";

interface I18nProviderProps {
  children: React.ReactNode;
  locale: string;
}

export default function I18nProvider({ children, locale }: I18nProviderProps) {
  const { i18n } = useTranslation();
  const router = useRouter();

  useEffect(() => {
    if (i18n.language !== locale) {
      i18n.changeLanguage(locale);
    }
  }, [locale, i18n]);

  return <>{children}</>;
}
```

## Step 6: Update Root Layout

Modify your `src/app/[lang]/layout.tsx` to include the i18n provider:

```typescript
import type { Metadata } from "next";
import "@/app/globals.css";
import QueryProvider from "@/providers/query-provider";
import I18nProvider from "@/providers/i18n-provider";

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
  params,
}: Readonly<{
  children: React.ReactNode;
  params: { lang: string };
}>) {
  return (
    <html lang={params.lang}>
      <body>
        <I18nProvider locale={params.lang}>
          <QueryProvider>{children}</QueryProvider>
        </I18nProvider>
      </body>
    </html>
  );
}
```

## Step 7: Update Auth View Component

Modify your `src/views/auth-view/auth-view.tsx` to properly import and use translations:

```typescript
"use client";
import { useSearchParams } from "next/navigation";
import { useForm } from "react-hook-form";
import { useTranslation } from "react-i18next";
import { useLogin, useRegister } from "@/utils";
import "./auth-view.css";
import { Input } from "@/components";
import type { TAuthnDataRequest } from "@/types";

export default function AuthView() {
  const { t } = useTranslation();
  const searchParams = useSearchParams();
  const mode = searchParams.get("mode") || "signin";

  // ... rest of your component code remains the same
}
```

## Step 8: Create Language Switcher Component

Create `src/components/language-switcher.tsx`:

```typescript
"use client";
import { useRouter, usePathname } from "next/navigation";
import { useTranslation } from "react-i18next";

export default function LanguageSwitcher() {
  const { i18n } = useTranslation();
  const router = useRouter();
  const pathname = usePathname();

  const changeLanguage = (locale: string) => {
    i18n.changeLanguage(locale);
    const newPath = pathname.replace(/^\/[a-z]{2}/, `/${locale}`);
    router.push(newPath);
  };

  return (
    <div className="language-switcher">
      <button
        onClick={() => changeLanguage("en")}
        className={i18n.language === "en" ? "active" : ""}
      >
        EN
      </button>
      <button
        onClick={() => changeLanguage("pl")}
        className={i18n.language === "pl" ? "active" : ""}
      >
        PL
      </button>
    </div>
  );
}
```

## Step 9: Update Translation Files

Ensure your translation files are properly structured. Your current files look good, but make sure they have all the keys you need:

**src/locales/en/common.json:**

```json
{
  "AUTH_EMAIL_LABEL": "Email",
  "AUTH_PASSWORD_LABEL": "Password",
  "AUTH_EMAIL_PLACEHOLDER": "Enter your email",
  "AUTH_PASSWORD_PLACEHOLDER": "Enter your password",
  "AUTH_CONFIRM_PASSWORD_LABEL": "Confirm Password",
  "AUTH_USER_NAME_LABEL": "User Name",
  "AUTH_USER_NAME_PLACEHOLDER": "Enter your user name",
  "AUTH_CONFIRM_PASSWORD_PLACEHOLDER": "Confirm your password",
  "AUTH_LOGIN_TITLE": "Login",
  "AUTH_REGISTER_TITLE": "Register"
}
```

**src/locales/pl/common.json:**

```json
{
  "AUTH_EMAIL_LABEL": "Email",
  "AUTH_PASSWORD_LABEL": "Hasło",
  "AUTH_EMAIL_PLACEHOLDER": "Wprowadź swój email",
  "AUTH_PASSWORD_PLACEHOLDER": "Wprowadź swoje hasło",
  "AUTH_CONFIRM_PASSWORD_LABEL": "Potwierdź hasło",
  "AUTH_USER_NAME_LABEL": "Nazwa użytkownika",
  "AUTH_USER_NAME_PLACEHOLDER": "Wprowadź swoją nazwę użytkownika",
  "AUTH_CONFIRM_PASSWORD_PLACEHOLDER": "Potwierdź swoje hasło",
  "AUTH_LOGIN_TITLE": "Zaloguj się",
  "AUTH_REGISTER_TITLE": "Zarejestruj się"
}
```

## Step 10: Update Component Exports

Update your `src/components/index.ts` to export the language switcher:

```typescript
export { default as Input } from "./input";
export { default as LanguageSwitcher } from "./language-switcher";
```

## Step 11: Update Provider Index

Update your `src/providers/index.ts`:

```typescript
export { default as QueryProvider } from "./query-provider";
export { default as I18nProvider } from "./i18n-provider";
```

## Step 12: Usage Examples

### Basic Translation Usage:

```typescript
import { useTranslation } from "react-i18next";

function MyComponent() {
  const { t } = useTranslation();

  return <h1>{t("AUTH_LOGIN_TITLE")}</h1>;
}
```

### Translation with Variables:

```typescript
// In your translation files:
// "WELCOME_MESSAGE": "Welcome, {{name}}!"

const { t } = useTranslation();
return <p>{t("WELCOME_MESSAGE", { name: "John" })}</p>;
```

### Pluralization:

```typescript
// In your translation files:
// "ITEMS_COUNT": "{{count}} item",
// "ITEMS_COUNT_plural": "{{count}} items"

const { t } = useTranslation();
return <p>{t("ITEMS_COUNT", { count: 5 })}</p>;
```

## Step 13: Testing Your Setup

1. Start your development server: `npm run dev`
2. Navigate to `/en` or `/pl` routes
3. Test the language switcher
4. Verify that translations are working correctly

## Troubleshooting

### Common Issues:

1. **"t is not defined" error**: Make sure you import `useTranslation` and call `const { t } = useTranslation();`

2. **Translations not loading**: Check that your i18n configuration is properly imported in your layout

3. **Route not found**: Ensure your middleware is properly configured and the matcher pattern is correct

4. **Language not persisting**: Make sure the I18nProvider is wrapping your app and receiving the correct locale prop

### Debug Tips:

- Use browser dev tools to check if translations are loaded
- Check the Network tab to see if translation files are being fetched
- Use `console.log(i18n.language)` to debug current language
- Verify that your middleware is running by adding console logs

## Additional Features

### Namespace Support:

Create separate files for different features:

- `src/locales/en/auth.json`
- `src/locales/en/dashboard.json`

Then use: `t('auth:LOGIN_TITLE')`

### Lazy Loading:

For better performance, you can lazy load translations:

```typescript
import Backend from "i18next-http-backend";

i18n.use(Backend).init({
  // ... other config
  backend: {
    loadPath: "/locales/{{lng}}/{{ns}}.json",
  },
});
```

This setup will provide you with a fully functional internationalization system for your Next.js application with react-i18next and next-i18n-router.
